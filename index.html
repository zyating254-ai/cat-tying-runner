<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cat Typing Runner</title>

<style>
  :root{
    /* èƒŒæ™¯ï¼šç²‰ç´« */
    --bg1:#ffb3e6;
    --bg2:#bfa8ff;

    /* é¢æ¿ï¼šç²‰è“ */
    --panel1:#bfe8ff;
    --panel2:#f7d6ff;

    --shadow: 0 22px 45px rgba(0,0,0,.18);
  }

  *{ box-sizing:border-box; }

  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background: radial-gradient(circle at 20% 20%, var(--bg1), transparent 45%),
                radial-gradient(circle at 80% 30%, var(--bg2), transparent 55%),
                linear-gradient(135deg, #ff9ad5, #c9a6ff);
    font-family: "Segoe UI", "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
  }

  /* æ¡†æ¶å˜å¤§ */
  .wrap{
    width: 940px;           /* âœ… æ›´å¤§ */
    max-width: 92vw;
    padding: 26px 28px 30px;
    border-radius: 22px;
    background: linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.60));
    box-shadow: var(--shadow);
    border: 1px solid rgba(255,255,255,.6);
    backdrop-filter: blur(10px);
  }

  .title{
    text-align:center;
    margin: 0 0 18px;
    font-size: 30px;
    letter-spacing: .5px;
  }

  /* äº”é¢œå…­è‰²æ ‡é¢˜ */
  .rainbow-title{
    background: linear-gradient(90deg,
      #ff4d6d, #ff9f1c, #ffd166, #06d6a0, #118ab2, #8338ec);
    -webkit-background-clip:text;
    background-clip:text;
    color: transparent;
    font-weight: 800;
  }

  /* è·‘é“ */
  .track{
    position: relative;
    height: 90px;
    border-radius: 60px;
    background: linear-gradient(90deg, rgba(255,255,255,.55), rgba(255,255,255,.25));
    overflow: hidden;
    margin-bottom: 18px;
    border: 1px solid rgba(0,0,0,.06);
  }
  .lane{
    position:absolute;
    left: 18px;
    right: 18px;
    top: 50%;
    height: 6px;
    transform: translateY(-50%);
    border-radius: 999px;
    background: repeating-linear-gradient(
      90deg,
      rgba(0,0,0,.18) 0 18px,
      transparent 18px 40px
    );
    opacity:.35;
  }

  /* è¿›åº¦æ¡ï¼ˆç²‰è“ï¼‰ */
  .progress{
    position:absolute;
    left:0; top:0;
    height:100%;
    width:0%;
    background: linear-gradient(90deg, rgba(160,220,255,.85), rgba(255,190,240,.60));
    transition: width .08s linear;
  }

  /* çŒ«å®¹å™¨ */
  .cat{
    position:absolute;
    left: 12px;
    bottom: 10px;
    transition: left .08s linear;
    filter: drop-shadow(0 6px 10px rgba(0,0,0,.18));
  }
  .cat img{
    height: 64px;
    user-select:none;
    pointer-events:none;
    display:block;
  }

  /* é¢æ¿ï¼ˆç²‰è“è‰²ï¼‰ */
  .panel{
    padding: 18px 18px 16px;
    border-radius: 18px;
    background: linear-gradient(135deg, rgba(180,235,255,.92), rgba(255,210,245,.72));
    border: 1px solid rgba(255,255,255,.7);
    box-shadow: 0 14px 28px rgba(0,0,0,.10);
  }

  /* å¯¹ç…§æ–‡å­—ï¼šäº”é¢œå…­è‰²ï¼ˆé€å­—ä¸Šè‰²ï¼‰ */
  .target{
    font-size: 18px;
    line-height: 1.8;
    padding: 12px 14px;
    border-radius: 14px;
    background: rgba(255,255,255,.70);
    border: 1px solid rgba(0,0,0,.06);
    margin-bottom: 12px;
    min-height: 64px;
  }

  .correct{
    font-weight: 700;
  }
  .wrong{
    text-decoration: underline wavy;
    font-weight: 800;
    color: #ff2d55;
  }

  textarea{
    width:100%;
    height: 130px;
    resize:none;
    padding: 12px 14px;
    font-size: 18px;
    border-radius: 14px;
    border: 1px solid rgba(0,0,0,.14);
    outline:none;
    background: rgba(255,255,255,.82);
  }

  .row{
    display:flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-top: 12px;
  }

  .box{
    flex: 1;
    min-width: 220px;
    padding: 10px 12px;
    border-radius: 14px;
    background: rgba(255,255,255,.70);
    border: 1px solid rgba(0,0,0,.06);
    font-size: 15px;
  }

  .label-rainbow{
    font-weight: 800;
    background: linear-gradient(90deg,#ff4d6d,#ff9f1c,#ffd166,#06d6a0,#118ab2,#8338ec);
    -webkit-background-clip:text;
    background-clip:text;
    color: transparent;
  }

  .buttons{
    display:flex;
    gap: 12px;
    margin-top: 12px;
    flex-wrap: wrap;
  }

  button{
    padding: 10px 16px;
    border-radius: 14px;
    border: 1px solid rgba(0,0,0,.12);
    background: rgba(255,255,255,.78);
    cursor:pointer;
    font-size: 15px;
    font-weight: 700;
  }
  button:hover{ background: rgba(255,255,255,.92); }

  /* çŒ«â€œèµ°è·¯â€å°åŠ¨ç”»ï¼ˆä¼šè·Ÿéšè¾“å…¥èŠ‚å¥è½»å¾®è·³åŠ¨ï¼‰ */
  .walk{
    animation: bob .22s infinite alternate ease-in-out;
  }
  @keyframes bob{
    from{ transform: translateY(0px); }
    to{ transform: translateY(-3px); }
  }

  /* çŒ«å›¾ç‰‡ä¸¢å¤±æç¤ºï¼ˆå¦‚æœ cat.png ä¸å­˜åœ¨ä¼šæ˜¾ç¤ºï¼‰ */
  .cat-missing{
    position:absolute;
    left: 16px;
    bottom: 18px;
    padding: 6px 10px;
    border-radius: 10px;
    background: rgba(255,255,255,.88);
    border: 1px solid rgba(0,0,0,.10);
    font-size: 12px;
    color:#333;
  }
</style>
</head>

<body>
  <div class="wrap">
    <h2 class="title"><span class="rainbow-title">ğŸ¾ Cat Typing Runner</span></h2>

    <div class="track" id="track">
      <div class="progress" id="progress"></div>
      <div class="lane"></div>

      <!-- âœ… å°çŒ«å¿…é¡»åœ¨è¿™é‡Œæ˜¾ç¤ºï¼ˆä¸æ˜¯å†™è¿›æ–‡å­—é‡Œï¼‰ -->
      <div class="cat" id="cat">
        <img id="catImg" src="./cat.png" alt="cat">
      </div>

      <div class="cat-missing" id="catMissing" style="display:none;">
        âš  cat.png ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆindex.html ã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã« cat.png ã‚’ç½®ã„ã¦ã­ï¼‰
      </div>
    </div>

    <div class="panel">
      <div class="target" id="target"></div>

      <textarea id="input" placeholder="ã“ã“ã‹ã‚‰å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¸Šã®è‹±æ–‡ã‚’è¦‹ãªãŒã‚‰ï¼‰"></textarea>

      <div class="row">
        <div class="box"><span class="label-rainbow">æ™‚é–“</span>ï¼š<b id="time">0.0</b> ç§’</div>
        <div class="box"><span class="label-rainbow">é€Ÿåº¦</span>ï¼š<b id="cpm">0</b> CPM</div>
        <div class="box"><span class="label-rainbow">æ­£ç¢ºç‡</span>ï¼š<b id="acc">0.0</b>%</div>
      </div>

      <div class="buttons">
        <button id="restart">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button id="next">æ¬¡ã®è‹±æ–‡</button>
      </div>
    </div>
  </div>

<script>
  // ===== è‹±æ–‡æ‰“å­—æ¨¡æ¿ï¼ˆä½ è¦æ±‚ï¼šæ¨¡æ¿è‹±æ–‡ï¼‰=====
  const paragraphs = [
  "Typing practice is important for beginners.Start slowly and focus on accuracy first.",

  "The quick brown fox jumps over the lazy dog.This sentence contains every letter of the alphabet.",

  "I am learning programming step by step.Writing code requires patience and attention to detail.",

  "Practice makes progress.Small improvements every day lead to big results.",

  "Good typing rhythm is more important than speed.Stay relaxed and keep your hands comfortable.",

  "Learning new skills can be challenging but rewarding.Do not be afraid of making mistakes.",

  "Consistency is the key to success.Even short practice sessions are valuable.",

  "Focus on what you are typing right now.Clear thinking helps reduce typing errors."
];

  const colors = ["#ff4d6d","#ff9f1c","#ffd166","#06d6a0","#118ab2","#8338ec"];

  const targetEl = document.getElementById("target");
  const inputEl = document.getElementById("input");
  const timeEl = document.getElementById("time");
  const cpmEl = document.getElementById("cpm");
  const accEl = document.getElementById("acc");

  const trackEl = document.getElementById("track");
  const catEl = document.getElementById("cat");
  const catImg = document.getElementById("catImg");
  const progressEl = document.getElementById("progress");

  const catMissing = document.getElementById("catMissing");

  let targetText = "";
  let startTime = null;

  // æ£€æµ‹å›¾ç‰‡æ˜¯å¦åŠ è½½æˆåŠŸï¼šå¤±è´¥å°±æ˜¾ç¤ºæç¤º
  catImg.addEventListener("error", () => {
    catMissing.style.display = "block";
  });

  function pickSentence(){
  return paragraphs[Math.floor(Math.random() * paragraphs.length)];
}

  function reset(){
    targetText = pickSentence();
    inputEl.value = "";
    startTime = null;
    timeEl.textContent = "0.0";
    cpmEl.textContent = "0";
    accEl.textContent = "0.0";
    progressEl.style.width = "0%";
    catEl.style.left = "12px";
    render("");
  }

  // äº”é¢œå…­è‰²ï¼šæ¯ä¸ªå­—ç¬¦æŒ‰ index å–é¢œè‰²
  function rainbowSpan(ch, i, cls){
    const color = colors[i % colors.length];
    return `<span class="${cls}" style="color:${color}">${escapeHTML(ch)}</span>`;
  }

  function escapeHTML(str){
    return str.replaceAll("&","&amp;")
              .replaceAll("<","&lt;")
              .replaceAll(">","&gt;")
              .replaceAll('"',"&quot;")
              .replaceAll("'","&#039;");
  }

  function render(typed){
    let html = "";
    let correct = 0;

    for(let i=0;i<targetText.length;i++){
      const ch = targetText[i];

      if(typed[i] == null){
        // æœªè¾“å…¥ï¼šä¹Ÿç”¨å½©è‰²æ˜¾ç¤ºï¼ˆæ·¡ä¸€ç‚¹ï¼‰
        const color = colors[i % colors.length];
        html += `<span style="color:${color}; opacity:.55">${escapeHTML(ch)}</span>`;
      }else if(typed[i] === ch){
        html += rainbowSpan(ch, i, "correct");
        correct++;
      }else{
        html += `<span class="wrong">${escapeHTML(ch)}</span>`;
      }
    }

    targetEl.innerHTML = html;

    const progress = correct / targetText.length;
    progressEl.style.width = (progress * 100) + "%";

    // è®¡ç®—çŒ«çš„æœ€å¤§ç§»åŠ¨è·ç¦»
    const maxX = trackEl.clientWidth - catEl.clientWidth - 18;
    catEl.style.left = (12 + maxX * progress) + "px";
  }

  function computeStats(typed){
    const correct = [...typed].filter((c,i)=>c===targetText[i]).length;
    const sec = startTime ? (performance.now() - startTime)/1000 : 0;
    const cpm = sec > 0 ? Math.round(correct/sec*60) : 0;
    const acc = typed.length ? (correct/typed.length*100) : 0;
    return {correct, sec, cpm, acc};
  }

  inputEl.addEventListener("input", ()=>{
    const typed = inputEl.value;

    if(startTime === null && typed.length > 0){
      startTime = performance.now();
    }

    render(typed);

    // çŒ«èµ°è·¯åŠ¨ç”»ï¼šåªè¦åœ¨è¾“å…¥å°±æŠ–åŠ¨ä¸€ä¸‹
    if(typed.length > 0) catEl.classList.add("walk");
    if(typed.length === 0) catEl.classList.remove("walk");

    const {sec, cpm, acc, correct} = computeStats(typed);
    timeEl.textContent = sec.toFixed(1);
    cpmEl.textContent = cpm.toString();
    accEl.textContent = acc.toFixed(1);

    // å®Œæˆååœä½
    if(typed.length === targetText.length && correct === targetText.length){
      catEl.classList.remove("walk");
      inputEl.blur();
    }
  });

  document.getElementById("restart").addEventListener("click", reset);
  document.getElementById("next").addEventListener("click", reset);

  reset();
</script>
</body>
</html>